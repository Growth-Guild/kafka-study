# Chapter 3. 카프카 기본 개념과 구조

## 카프카 기초 다지기
* 카프카 구성 요소
  * 주키퍼: 카프카의 메타데이터 관리 및 브로커의 정상상태 점검을 담당한다.
  * 카프카 클러스터: 여러 대의 브로커를 구성한 클러스터를 의미한다.
  * 브로커: 카프카가 설치된 서버 또는 노드를 의미한다.
  * 프로듀서: 카프카로 메시지를 보내는 역할을 하는 클라이언트를 의미한다.
  * 컨슈머: 카프카에서 메시지를 꺼내서 소비하는 역할을 하는 클라이언트를 의미한다.
  * 토픽: 카프카는 메시지 피드들을 토픽으로 구분하고, 각 토픽의 이름은 카프카 내에서 고유하다.
  * 파티션: 병렬 처리 및 고성능을 얻기 위해 하나의 토픽을 여러 개로 나눈 것을 말한다.
  * 세그먼트: 프로듀서가 전송한 실제 메시지가 브로커의 로컬 디스크에 저장되는 파일을 말한다.
  * 메시지 or 레코드: 프로듀서가 브로커로 전송하거나 컨슈머가 읽어가는 데이터 조각을 말한다.

### 리플리케이션 (Replication)
* 리플리케이션이란 각 메시지들을 카프카 클러스터 내 브로커들에 복제하여 분산시키는 것을 말한다.
* 리플리케이션 덕분에 하나의 브로커가 종료되더라도 카프카는 안정성을 유지할 수 있다.
* 토픽 생성 명령어 중, replication-factor {N}은 카프카 내에 N개의 리플리케이션(원본 포함)을 유지하겠다는 의미다.
* 리플리케이션 팩터 수가 커지면 안정성은 높아지지만 그만큼 브로커 리소스를 많이 사용하게 된다. (복제에 대한 오버헤드와 성능의 트레이드 오프를 고려하여 브로커를 효율적으로 운영해야 한다.)

### 파티션 (Partition)
* 하나의 토픽이 한 번에 처리할 수 있는 한계를 높이기 위해 토픽 하나를 여러 개로 나눠 병렬 처리가 가능하게 만든 것을 파티션이라고 한다.
* 파티션을 여러 개로 나눔으로써 분산 처리가 가능해진다.
* 나누어진 파티션 수만큼 컨슈머를 연결할 수 있다.
* 파티션 수는 초기 생성 후 언제든지 늘릴 수 있지만, 반대로 한 번 늘린 파티션 수는 다시 줄일 수 없다.
  * 따라서 초기에 토픽을 생성할 때는 파티션 수를 작게 생성한 후, 메시지 처리량이나 컨슈머의 LAG 등을 모니터링하면서 조금씩 늘려가는 방법이 좋다.
* 컨슈머의 LAG이란 (프로듀서가 보낸 메시지 수 - 컨슈머가 가져간 메시지 수)를 나타낸다.
