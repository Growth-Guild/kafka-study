## 7장(카프카 운영과 모니터링)

* 주키퍼 구성
  * 주키퍼는 카프카의 파티션과 메타데이터를 저장하고 컨트롤러 서버를 선출하는 동작을 수행한다
  * 앞으로의 카프카 릴리즈에서는 주키퍼 의존성을 없애는 방향으로 개발되고 있으므로, 머지않아 의존성이 없어진 버전이 릴리즈 될 것이다
  * 주키퍼는 기본적으로 과반수 구성을 기반으로 동작하므로 반드시 홀수로 구성해야 한다. 주키퍼 3대를 사용한다면 과반수인 2를 충족할 수 있는 최대 1대까지의 주키퍼 장애를 허용한다
  
* 카프카 구성
  * 카프카는 주키퍼와 다르게 홀수의 서버가 필요하지 않으며 필요한 수만큼 서버를 띄워 사용하면 된다
  * 추후에 손쉽게 확장이 가능하므로, 일단 최소 필요 서버만 구성하여 사용하는것이 좋다

* 모니터링 시스템
  * 카프카를 모니터링 하는 방법은 여러가지가 있으나, 대표적으로 어플리케이션 로그 분석과 JMX 를 통해 브로커들의 메트릭 정보를 모니터링 한다
  * 카프카는 log4j 라이브러리를 통해 로깅하므로, 설정을 통해 디버깅 레벨을 변경할 수 있다
  * JMX 는 자바 어플리케이션의 모니터링을 위한 도구를 제공하는 API 이며, 브로커 설정을 통해 JMX 포트를 오픈후 해당 포트를 모니터링 프로메테우스와 익스포터를 통해 모니터링 시스템을 구성한다
  * 카프카에서는 여러 JMX 메트릭 정보를 제공하므로 필요한 메트릭 정보는 대시보드에 추가하여 모니터링 할 수 있다
  * 모니터링을 계속 사람이 확인할 수는 없으므로 초기에 메트릭 지표가 어떻게 움직이는지 확인하고, 이상 임계치를 적절하게 적용하여 사용하여야 한다
