## 4장(카프카의 내부 동작 원리와 구현)

* 리플리케이션 동작 개요
  * 카프카 토픽 생성 시 리플리케이션 동작을 위해 무조건 replication-factor 를 설정해야 한다
  * kafka-topics.sh 의 --describe 옵션을 통해서
  파티션의 개수, 리플리케이션 팩터 수, 리플리케이션이 존재하는 브로커등의 상세 정보를 확인할 수 있다
  * kafka-dump-log.sh --print-data-log --files ${세그먼트 파일} 을 통해 세그먼트의 상세정보를 확인할 수 있다.
  * 모든 리플리케이션에 로그가 복제되므로, 브로커 서버 장애 시 다른 브로커가 역할을 대체할 수 있다

* 리더와 팔로워
  * 각 리플리케이션은 리더와 팔로워로 구분된다. 리더는 한개만 존재하며 프로듀서/컨슈머는 리더에만 데이터를 전송/읽는다
  * 팔로워들은 리더에 문제가 생겼을 경우 리더가 될 준비를 하며, 지속적으로 리더의 변경사항을 반영한다

* 복제 유지와 커밋
  * 리더와 팔로워는 ISR(InSyncReplica) 라는 논리적 그룹으로 묶여 있으며 해당 그룹에 속하는 팔로워만이
  리더가 될 자격을 부여한다
  * 리더는 팔로워들이 메시지를 잘 복제하고있는지 감시하며, 복제가 잘 된 팔로워만이 ISR 그룹에 속하게 된다
  (ISR 목록은 토픽 상세보기를 통해 확인가능)
  * 모든 팔로워가 메시지를 복제하면, 리더는 내부적으로 하이워터마크라는 커밋 오프셋을 저장하며, 하이워터마크된 메시지만
  컨슈머에서 읽어갈 수 있다.
  * 성능 향상을 위해, 리더는 팔로워가 데이터를 잘 저장했는지 여부를 통신 응답으로 확인(ACK) 하지 않으며
  그대신 팔로워가 데이터 pull 요청시 응답에 추가적으로 새로운 메시지가 있다고 알리게 된다
  * 