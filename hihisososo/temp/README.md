## 9장(카프카 보안)

* 카프카는 보통 기업의 내부 시스템으로 구성되기 때문에, 사내에 보안 처리가 되어 있다면 보안에 크게 신경쓰지 않는다
* 카프카는 웹 관리도구가 제공되지 않기 때문에, 카프카에 익숙하지 않은 관리자는 보안을 구성하기가 쉽지 않다

### 카프카 보안의 세가지 요소
  * 카프카에 연결 가능한 클라이언트들은, 모든 권한을 가지고 있기 때문에 카프카에 접속할 수만 있다면 데이터가 유출되는 경우도 생길 수 있다
  * 또한 메시지 전송간, 암호화가 적용되어 있지 않기 때문에 패킷 탈취도 가능하다
  * 카프카는 이에 대해 3가지 보안 요소를 제공한다
    1. 암호화 
       * 카프카의 중간 패킷을 가로채서 원본 데이터를 볼 수 없도록 메시지를 암호화(SSL)
    2. 인증
       * 카프카 클라이언트들이 카프카로 접근할 때 안전하다고 확인된 클라이언트만 접근 허용
       * SASL(Simple Authentication and Security Layer) 방식을 사용하며 인증을 하며 네가지 메커니즘을 지원한다
    3. 권한(ACL)
       * 특정 클라이언트들에게 특정 권한을 부여
       * 접근 제어 리스트(ACL) 을 통해 제어하며 규칙 기반의 리시트를 만들어 접근 제어를 한다
       * ACL 규칙은 주키퍼에 저장되며, CLI 를 통해 토픽, 그룹, 클러스터 등의 접근 제어를 할 수 있다
       
### SSL 을 이용한 카프카 암호화
* 자바 기반 애플리케이션에서는 키스토어라고 불리는 인터페이스를 통해 퍼블릭/프라이빗 키 및 인증서를 추상화해 제공한다
* 클라이언트와 서버 사이에 자바 애플리케이션을 통해 SSL 연결을 할 때 클라이언트쪽에서는 트러스트스토어를, 서버쪽에서는 키스토어를 통해 암호화 연결을 한다
  * 키스토어 : 서버쪽에서 프라이빗 키와 인증서를 저장 및 자격 증명을 제공
  * 트러스트스토어 : 클라이언트쪽에서 서버가 제공하는 인증서를 검증하기 위한 퍼블릭 키와 서명된 인증서를 저장
* 아래와 같은 순서로 카프카에 SSL 적용을 한다
  1. CA 인증서 생성
  2. 트러스트스토어 생성(서버가 공인인증서를 발급받지 않은 경우)
  3. 인증서 자체 서명(서버가 공인인증서를 발급받지 않은 경우)
  4. server.properties 설정을 통해 브로커가 SSL 을 사용하도록 설정

### 커버로스를 이용한 카프카 인증
* 커버로스 : 티켓을 기반으로 하는 컴퓨터 네트워크 인증 프로토콜, 사용자의 신원을 식별하기 위한 용도로 사용하며 SSO 를 지원한다
* 커버로스 서버 구성 후, 카프카의 설정을 통해 커버로스 인증을 구성할 수 있다

### ACL을 이용한 카프카 권한 설정
* 카프카의 권한 설정을 위해 server.properties 파일의 ACL 관련 설정을 추가하여야 한다
* 해당 설정을 추가한 뒤, kafka-acls.sh 명령어를 통해 특정 유저에 대한 ACL 규칙을 생성할 수 있다

